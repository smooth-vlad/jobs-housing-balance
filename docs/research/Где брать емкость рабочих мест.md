
Да — в CS1 точная «ёмкость рабочих мест» берётся из самих AI-классов зданий. В ваниле и при активных модах (RICO, Realistic Population и т. п.) правильный путь — обращаться к методам расчёта рабочих мест конкретных AI. Ниже — выжимка по реально существующим методам и их сигнатурам (подтверждены по документации/вики модов, которые патчат именно эти методы).

# Где брать ёмкость рабочих мест

**ZONED/производственные классы, которые дают рабочие места и влияют на RCI-баланс:**

- **CommercialBuildingAI**
    
    - `CalculateWorkplaceCount(ItemClass.Level level, Randomizer r, int width, int length, out int level0, out int level1, out int level2, out int level3)` — возвращает распределение рабочих мест по уровню образования (L0…L3). ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
        
    - Рядом есть `CalculateVisitplaceCount` (для посетителей) — не путать с рабочими местами. ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
        
- **IndustrialBuildingAI**
    
    - `CalculateWorkplaceCount(...)` — та же сигнатура и смысл, что выше. ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
        
- **IndustrialExtractorAI** (Industries DLC, добывающие)
    
    - `CalculateWorkplaceCount(...)` — та же сигнатура. ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
        
- **OfficeBuildingAI**
    
    - `CalculateWorkplaceCount(...)` — та же сигнатура. ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
        

> Почему важно вызывать именно эти методы: крупные моды (напр., **Realistic Population 2**) перехватывают **эти** методы Harmony-патчами и подменяют формулы. Если ты вызываешь `CalculateWorkplaceCount` у AI, ты автоматически получаешь **фактическую** ёмкость с учётом модов и уровня здания/площади лота. ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))

**Служебные (city services) — больницы, полиция, школы и т. п.:**

- Их занятость **скрыта в ваниле**, и эти здания **не жалуются** на нехватку/уровень образования работников, умеют функционировать даже при нуле сотрудников. Поэтому для баланса «жильё↔работа» их обычно **исключают** (или считают отдельным слоем/опцией). ([skylines.paradoxwikis.com](https://skylines.paradoxwikis.com/Service_buildings?utm_source=chatgpt.com "Service buildings - Cities: Skylines Wiki"))
    

# Что означают параметры `CalculateWorkplaceCount`

- **`ItemClass.Level level`** — текущий уровень здания (для growable влияет на доли L0–L3).
    
- **`Randomizer r`** — детерминированный рандом (обычно инициализируют ID здания) — нужен для воспроизводимых вариаций. (Подтверждается тем, что моды патчат метод с таким параметром.) ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
    
- **`width, length`** — размер лота **в клетках** (cell units); большинство формул масштабируют ёмкость по площади. (Сигнатуры явно принимают `int width, int length`.) ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
    
- **`out level0…level3`** — число мест для: **L0** (необраз.), **L1** (осн. образование), **L2** (хорошо образ.), **L3**(высокообраз.). Сумма — общая ёмкость.
    

# Как получить «факт» vs «ёмкость»

- **Ёмкость**: бери из `CalculateWorkplaceCount` соответствующего AI (Commercial/Industrial/Extractor/Office). Это даёт **потенциальные** рабочие места (по образованию) — ровно то, что нужно для твоего режима «Capacity». ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
    
- **Факт**: обходи `Building.m_citizenUnits` и суммируй `CitizenUnits` с флагом **Work** — это реально занятые рабочие (то, что ты уже сделал в этапе B). На создание/синхронизацию юнитов влияет `BuildingAI.EnsureCitizenUnits`, который моды (RP2) тоже патчат — поэтому фактические числа будут в согласии с их логикой. ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
    

# Покрытие по типам и нюансы

- **Commercial/Office/Industrial/Extractor** — полностью закрываются `CalculateWorkplaceCount(...)`. (Включая специализации — IT-кластер и турист/развлеч. обрабатываются их AI-классами.) ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
    
- **Industries DLC (уникальные фабрики, склады)** — используют специализированные AI; часть из них не указана в патч-листе RP2. Для первой версии мода оставь их вне расчёта или добавь как опцию; при необходимости проверяй, существует ли у AI конкретного здания `CalculateWorkplaceCount` — если нет, не включай. Общие гайды подтверждают, что занятость индустрий часто никак не «штрафует» производство, т. е. эти здания больше играют роль «емкости занятости», чем требования для симуляции; это ещё один аргумент держать их отдельным слоем. ([Reddit](https://www.reddit.com/r/CitiesSkylines/comments/va87y6/industry_area_building_number_of_workers_and/?utm_source=chatgpt.com "Industry area building, number of workers and efficiency?"))
    
- **City services** — по умолчанию **исключаем** из баланса жилья↔работы (не участвуют в RCI-спросе, работают и без персонала). Добавь переключатель «включать сервисы» только как информативный слой, но не смешивай с основным балансом. ([skylines.paradoxwikis.com](https://skylines.paradoxwikis.com/Service_buildings?utm_source=chatgpt.com "Service buildings - Cities: Skylines Wiki"))
    

# Практические рекомендации для твоего мода

1. **Определяй тип AI** у `building.Info.m_buildingAI`.  
    Если AI ∈ {CommercialBuildingAI, IndustrialBuildingAI, IndustrialExtractorAI, OfficeBuildingAI} — считаем ёмкость через `CalculateWorkplaceCount(...)`. Иначе — пропускаем (или спец-правило по настройке).
    
2. **Всегда храни распределение по образованию (L0–L3)**. Это позволит строить твой индикатор «места − подходящие жители» и KPI «места − все жители».
    
3. **Совместимость с Realistic Population / RICO**: так как они патчат именно эти методы, вызов AI-метода уже возвращает **мод-корректные** ёмкости. Это лучше, чем читать XML RICO напрямую. ([GitHub](https://github.com/algernon-A/Realistic-Population-Revisited/wiki/Harmony-patches "Harmony patches · algernon-A/Realistic-Population-Revisited Wiki · GitHub"))
    
4. **Валидация:** для пары тестовых зданий сравни «ёмкость» (из AI) и «факт занятости» (из CitizenUnits) — отклонения ожидаемы (вакансии), но порядок величин должен совпадать.
    

# Почему не считать из служебных окон/графов

В игре данные по сервисам скрыты и не влияют на RCI спрос. Включение их в общий баланс исказит рекомендации по зонированию. Держи их отдельной теплокартой («какие сервисы тянут работников») и не смешивай с решениями «где строить жильё/офисы/коммерцию». ([skylines.paradoxwikis.com](https://skylines.paradoxwikis.com/Service_buildings?utm_source=chatgpt.com "Service buildings - Cities: Skylines Wiki"))

---

Если хочешь, я оформлю это как короткий раздел для твоего «Этап B — источники данных», с аккуратными ссылками на классы/методы и пометками «обязательно сохранять L0–L3».